<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LuckyDragon Casino - æç°</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="css/footer.css">
    <link rel="stylesheet" href="css/lobby.css">
    <link rel="stylesheet" href="css/account.css">
</head>

<body>
    <div class="bg-animated"></div>

    <!-- Main Navigation -->
    <nav class="main-nav">
        <div class="container nav-content">
            <a href="lobby.html" class="logo">
                <span class="logo-icon">ğŸ‰</span>
                <span class="logo-text">LuckyDragon</span>
            </a>
            <div class="nav-center">
                <div class="wallet-display">
                    <span class="wallet-icon">ğŸ’°</span>
                    <span class="wallet-amount" id="navBalance">$0</span>
                </div>
            </div>
            <div class="nav-right">
                <a href="account.html" class="btn btn-sm btn-outline">è¿”å›è´¦æˆ·</a>
            </div>
        </div>
    </nav>

    <!-- Withdraw Page -->
    <div class="withdraw-page">
        <div class="container">
            <div class="withdraw-layout">
                <div class="withdraw-main glass-card">
                    <h2>ğŸ“¤ æç°ç”³è¯·</h2>

                    <!-- Balance Info -->
                    <div class="withdraw-balance">
                        <div class="balance-item">
                            <span class="balance-label">å¯æç°ä½™é¢</span>
                            <span class="balance-value text-green" id="withdrawableBalance">$0.00</span>
                        </div>
                        <div class="balance-item">
                            <span class="balance-label">å¾…å®¡æ ¸æç°</span>
                            <span class="balance-value text-gold">$0.00</span>
                        </div>
                    </div>

                    <!-- Bank Account -->
                    <div class="bank-account-section">
                        <h4>ğŸ’³ ææ¬¾è´¦æˆ·</h4>
                        <div class="bank-account-card">
                            <div class="bank-logo">ğŸ¦</div>
                            <div class="bank-details">
                                <div class="bank-name">Maybank</div>
                                <div class="bank-number">**** **** **** 1234</div>
                                <div class="bank-holder">DEMO USER</div>
                            </div>
                            <button class="btn btn-sm btn-outline" onclick="changeBankAccount()">æ›´æ¢</button>
                        </div>
                        <p class="bank-note">* é¦–æ¬¡ææ¬¾éœ€è¦ç»‘å®šé“¶è¡Œå¡</p>
                    </div>

                    <!-- Amount Input -->
                    <div class="withdraw-amount-section">
                        <h4>æç°é‡‘é¢ (USD)</h4>
                        <input type="number" class="input-field" id="withdrawAmount" placeholder="æœ€ä½ $50" min="50">
                        <div class="amount-limits">
                            <span>æœ€ä½: $50</span>
                            <span>æœ€é«˜: $10,000/æ—¥</span>
                        </div>
                        <div class="quick-amounts">
                            <button onclick="setWithdrawAmount(100)">$100</button>
                            <button onclick="setWithdrawAmount(200)">$200</button>
                            <button onclick="setWithdrawAmount(500)">$500</button>
                            <button onclick="setWithdrawAmount(1000)">$1000</button>
                            <button onclick="setWithdrawAmount('all')">å…¨éƒ¨</button>
                        </div>
                    </div>

                    <!-- Password -->
                    <div class="password-section">
                        <h4>äº¤æ˜“å¯†ç </h4>
                        <input type="password" class="input-field" id="withdrawPassword" placeholder="è¯·è¾“å…¥äº¤æ˜“å¯†ç ">
                    </div>

                    <!-- Submit -->
                    <button class="btn btn-gold btn-lg" onclick="submitWithdraw()">
                        æäº¤æç°ç”³è¯·
                    </button>

                    <!-- Info -->
                    <div class="withdraw-info">
                        <h4>ğŸ“‹ æç°é¡»çŸ¥</h4>
                        <ul>
                            <li>æç°ç”³è¯·æäº¤åï¼Œé¢„è®¡ 1-24 å°æ—¶å†…å¤„ç†</li>
                            <li>VIP ä¼šå‘˜äº«å—ä¼˜å…ˆå¤„ç†æƒé™</li>
                            <li>é¦–æ¬¡æç°éœ€å®Œæˆèº«ä»½éªŒè¯</li>
                            <li>æç°éœ€æ»¡è¶³æµæ°´è¦æ±‚</li>
                        </ul>
                    </div>
                </div>

                <!-- Withdraw History -->
                <div class="withdraw-history glass-card">
                    <h3>ğŸ“œ æç°è®°å½•</h3>
                    <div class="history-list">
                        <div class="history-item">
                            <div class="history-info">
                                <div class="history-amount">$500.00</div>
                                <div class="history-bank">Maybank ****1234</div>
                            </div>
                            <div class="history-status completed">å·²å®Œæˆ</div>
                            <div class="history-time">2026-01-15 14:30</div>
                        </div>
                        <div class="history-item">
                            <div class="history-info">
                                <div class="history-amount">$200.00</div>
                                <div class="history-bank">Maybank ****1234</div>
                            </div>
                            <div class="history-status completed">å·²å®Œæˆ</div>
                            <div class="history-time">2026-01-10 09:15</div>
                        </div>
                    </div>
                    <a href="history.html" class="view-all-link">æŸ¥çœ‹å…¨éƒ¨è®°å½• â†’</a>
                </div>
            </div>
        </div>
    </div>

    <style>
        .withdraw-page {
            padding: 30px 0;
            min-height: calc(100vh - 80px);
        }

        .withdraw-layout {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
            max-width: 1100px;
            margin: 0 auto;
        }

        .withdraw-main {
            padding: 30px;
        }

        .withdraw-main h2 {
            margin-bottom: 30px;
        }

        .withdraw-balance {
            display: flex;
            gap: 40px;
            padding: 25px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            margin-bottom: 30px;
        }

        .balance-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .balance-item .balance-label {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .balance-item .balance-value {
            font-family: var(--font-display);
            font-size: 1.5rem;
            font-weight: 700;
        }

        .bank-account-section,
        .withdraw-amount-section,
        .password-section {
            margin-bottom: 25px;
        }

        .bank-account-section h4,
        .withdraw-amount-section h4,
        .password-section h4 {
            margin-bottom: 15px;
            color: var(--text-secondary);
        }

        .bank-account-card {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
        }

        .bank-logo {
            font-size: 2.5rem;
        }

        .bank-details {
            flex: 1;
        }

        .bank-name {
            font-weight: 600;
            margin-bottom: 3px;
        }

        .bank-number {
            font-family: monospace;
            color: var(--text-secondary);
        }

        .bank-holder {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .bank-note {
            margin-top: 10px;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .amount-limits {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .quick-amounts {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .quick-amounts button {
            flex: 1;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-amounts button:hover {
            background: rgba(255, 215, 0, 0.1);
            border-color: var(--color-gold);
        }

        .withdraw-info {
            margin-top: 30px;
            padding: 20px;
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.2);
            border-radius: 12px;
        }

        .withdraw-info h4 {
            margin-bottom: 15px;
            color: var(--color-gold);
        }

        .withdraw-info ul {
            list-style: none;
        }

        .withdraw-info li {
            padding: 8px 0;
            padding-left: 20px;
            position: relative;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .withdraw-info li::before {
            content: 'â€¢';
            position: absolute;
            left: 0;
            color: var(--color-gold);
        }

        .withdraw-history {
            padding: 25px;
        }

        .withdraw-history h3 {
            margin-bottom: 20px;
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .history-item {
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        .history-amount {
            font-weight: 700;
            margin-bottom: 3px;
        }

        .history-bank {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .history-status {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: 600;
            margin: 8px 0;
        }

        .history-status.completed {
            background: rgba(0, 210, 106, 0.2);
            color: var(--color-green);
        }

        .history-status.pending {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }

        .history-time {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        @media (max-width: 900px) {
            .withdraw-layout {
                grid-template-columns: 1fr;
            }
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase-config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/wallet.js"></script>
    <script>
        let withdrawableAmount = 0;

        async function initPage() {
            const user = await Auth.getCurrentUser();
            if (!user) {
                window.location.href = 'index.html';
                return;
            }

            const balance = parseFloat(user.balance || 0);
            withdrawableAmount = balance * 0.8; // 80% withdrawable

            document.getElementById('navBalance').textContent = '$' + balance.toLocaleString();
            document.getElementById('withdrawableBalance').textContent = '$' + withdrawableAmount.toLocaleString(undefined, { minimumFractionDigits: 2 });
        }

        function setWithdrawAmount(amount) {
            if (amount === 'all') {
                document.getElementById('withdrawAmount').value = Math.floor(withdrawableAmount);
            } else {
                document.getElementById('withdrawAmount').value = amount;
            }
        }

        async function submitWithdraw() {
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            const password = document.getElementById('withdrawPassword').value;

            if (!amount || amount < 50) {
                Auth.showNotification('æœ€ä½æç°é‡‘é¢ä¸º $50', 'error');
                return;
            }

            if (amount > withdrawableAmount) {
                Auth.showNotification('æç°é‡‘é¢è¶…è¿‡å¯æç°ä½™é¢', 'error');
                return;
            }

            if (!password) {
                Auth.showNotification('è¯·è¾“å…¥äº¤æ˜“å¯†ç ', 'error');
                return;
            }

            // Simulate withdraw
            Auth.showNotification('ğŸ‰ æç°ç”³è¯·å·²æäº¤ï¼é¢„è®¡ 1-24 å°æ—¶å†…åˆ°è´¦', 'success');

            // Demo: Deduct from balance
            const user = await Auth.getCurrentUser();
            await Wallet.updateBalance(user.id, -amount);
            await initPage();
        }

        function changeBankAccount() {
            const banks = ['Maybank', 'CIMB Bank', 'Public Bank', 'RHB Bank', 'Hong Leong Bank', 'AmBank', 'HSBC', 'Standard Chartered'];
            let bankList = 'é€‰æ‹©é“¶è¡Œ:\n';
            banks.forEach((b, i) => bankList += (i + 1) + '. ' + b + '\n');

            const bankChoice = prompt(bankList);
            const bankIndex = parseInt(bankChoice) - 1;
            if (bankIndex < 0 || bankIndex >= banks.length) {
                Auth.showNotification('è¯·é€‰æ‹©æœ‰æ•ˆçš„é“¶è¡Œ', 'error');
                return;
            }

            const accountNumber = prompt('è¯·è¾“å…¥é“¶è¡Œè´¦å·:');
            if (!accountNumber || accountNumber.length < 8) {
                Auth.showNotification('è¯·è¾“å…¥æœ‰æ•ˆçš„é“¶è¡Œè´¦å·', 'error');
                return;
            }

            const holderName = prompt('è¯·è¾“å…¥æŒå¡äººå§“å:');
            if (!holderName) {
                Auth.showNotification('è¯·è¾“å…¥æŒå¡äººå§“å', 'error');
                return;
            }

            // Update display
            document.querySelector('.bank-name').textContent = banks[bankIndex];
            document.querySelector('.bank-number').textContent = '**** **** **** ' + accountNumber.slice(-4);
            document.querySelector('.bank-holder').textContent = holderName.toUpperCase();

            // Save to localStorage
            localStorage.setItem('bankAccount', JSON.stringify({
                bank: banks[bankIndex],
                number: accountNumber,
                holder: holderName
            }));

            Auth.showNotification('âœ… é“¶è¡Œè´¦æˆ·å·²æ›´æ–°', 'success');
        }

        document.addEventListener('DOMContentLoaded', initPage);
    </script>
    <script src="js/footer.js"></script>
</body>

</html>